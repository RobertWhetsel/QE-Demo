<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Eye - Welcome</title>

    <!-- Core variables -->
    <link rel="stylesheet" href="/src/views/styles/core/variables.css">
    
    <!-- Theme styles - Must be after variables -->
    <link rel="stylesheet" href="/src/views/styles/themes/light.css">
    <link rel="stylesheet" href="/src/views/styles/themes/dark.css">
    
    <!-- Base styles -->
    <link rel="stylesheet" href="/src/views/styles/core/base.css">
    
    <!-- Layout styles -->
    <link rel="stylesheet" href="/src/views/styles/layouts/container.css">
    
    <!-- Component styles -->
    <link rel="stylesheet" href="/src/views/styles/components/navigation.css">
    <link rel="stylesheet" href="/src/views/styles/components/button.css">
    <link rel="stylesheet" href="/src/views/styles/components/message.css">

    <style>
        body {
            background-color: var(--color-surface-secondary);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .welcome-container {
            background-color: var(--color-surface-primary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-lg);
            width: 100%;
            max-width: 500px;
            text-align: center;
            margin: var(--spacing-sm);
        }

        .logo {
            max-width: 200px;
            margin-bottom: var(--spacing-lg);
        }

        h2 {
            color: var(--color-text-primary);
            font-size: 1.3rem;
            margin-bottom: var(--spacing-sm);
        }

        .instructions {
            margin: var(--spacing-md) 0;
            text-align: left;
        }

        .instructions p {
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .instructions ol {
            color: var(--color-text-primary);
            padding-left: var(--spacing-lg);
            margin: 0;
        }

        .instructions li {
            margin-bottom: var(--spacing-xs);
            line-height: 1.4;
        }

        .begin-button {
            background-color: var(--color-brand-primary);
            color: var(--color-text-on-brand);
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all var(--transition-speed);
            width: 100%;
            max-width: 200px;
            margin-top: var(--spacing-md);
        }

        .begin-button:hover {
            background-color: var(--color-brand-primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .begin-button:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }
    </style>
</head>
<body>
    <div class="welcome-container">
        <img src="assets/qeLogoBW.png" alt="Quantum Eye Logo" class="logo">
        <div class="instructions">
            <h2>Login Instructions</h2>
            <p>Welcome to the Quantum Eye system. Please follow these steps:</p>
            <ol>
                <li>Click the Begin button below to start</li>
                <li>The system will check for existing users</li>
                <li>If users exist, you'll be taken to the login page</li>
                <li>If no users exist, you'll be directed to create a Genesis Admin account</li>
            </ol>
        </div>
        <button id="begin-button" class="begin-button">Begin</button>
    </div>

    <script>
        async function loadUsersFromCSV() {
            try {
                const response = await fetch('/src/models/data/users.csv');
                if (!response.ok) {
                    throw new Error('Failed to load users.csv');
                }
                
                const csvText = await response.text();
                const lines = csvText.split('\n').filter(line => line.trim());
                const headers = lines[0].split(',').map(h => h.trim());
                
                const users = lines.slice(1).map(line => {
                    const values = line.split(',').map(v => v.trim());
                    const user = {};
                    headers.forEach((header, i) => {
                        user[header] = values[i] || '';
                    });
                    return user;
                });

                return {
                    users: users,
                    pendingUsers: []
                };
            } catch (error) {
                console.error('Error loading users:', error);
                return { users: [], pendingUsers: [] };
            }
        }

        async function handleBegin() {
            try {
                const appData = await loadUsersFromCSV();
                sessionStorage.setItem('appData', JSON.stringify(appData));
                
                // Check for existing users
                if (appData.users.length > 0) {
                    window.location.href = '/src/views/pages/login.html';
                } else {
                    window.location.href = '/src/views/pages/genesisAdmin.html';
                }
            } catch (error) {
                console.error('Error during initialization:', error);
                window.location.href = '/src/views/pages/404.html';
            }
        }

        // Add click handler to begin button
        document.getElementById('begin-button').addEventListener('click', handleBegin);
    </script>
</body>
</html>
